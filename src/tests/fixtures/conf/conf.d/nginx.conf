# sources

[source:nginx-error]
globs = **/nginx-error*
prefix = \d{4}/\d{2}/\d{2}\s+\d{2}:\d{2}:\d{2}\s+\[\w+\]\s+
pattern = 
    # timestamp
    (?P<timestamp>\d{4}/\d{2}/\d{2}\s+\d{2}:\d{2}:\d{2})\s+
    
    # severity
    \[(?P<severity>\w+)\]\s+
    
    # message
    (?P<message>.*)

form = nginx:Error

[source:nginx-access]
globs = **/nginx-access*
pattern =
    
    # ipv4 address
    (?P<ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\s+
    
    # reserved
    -\s+
    
    # user
    (?:(?P<user>\w+)|-)\s+
    
    # timestamp
    \[(?P<timestamp>\d{2}/\w{3}/\d{4}:\d{2}:\d{2}:\d{2}\s+\+\d{4})\]\s+
    
    # request
    "(?:(?P<method>\w+)\s+(?P<uri>.+)\s+HTTP\/(?P<version>\d\.\d)|-)"\s+
    
    # status code
    (?:(?P<status>\d+)|-)\s+
    
    #  bytes sent
    (?:(?P<bytes_sent>\d+)|-)\s+
    
    # referrer
    "(?P<referrer>.*?)"\s+
    
    # user agent
    "(?P<user_agent>.*?)"\s+
    
    # request time
    (?P<request_time>\d+\.\d+)
    
    # extras
    (?:\s+(?:
    "guru_id=(?:(?P<guru_id>\w+)|-)"|
    "\w+=.+?"))*

form = nginx:Access

# sinks

[sink:nginx-search]
type = ElasticSearch
connections = http://localhost:9200
timeout = 10

# channels

[channel:nginx-access-search]
sources = nginx-access
sink = nginx-search
form = nginx:AccessSearch

[channel:nginx-error-search]
sources = nginx-error
sink = nginx-search
form = nginx:ErrorSearch
